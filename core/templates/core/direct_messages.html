{% extends 'core/base.html' %}
{% load static %}
{% load custom_tags %}
{% block content %}

<div class="container mt-4" style="max-width: 800px;">
  <div class="card shadow border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">ðŸ’¬ Conversation with {{ receiver.username }}</h4>
      {% if user|has_attr:"proctorprofile" %}
        <a href="{% url 'proctor_dashboard' %}" class="btn btn-light btn-sm">â¬… Back</a>
      {% else %}
        <a href="{% url 'student_dashboard' %}" class="btn btn-light btn-sm">â¬… Back</a>
      {% endif %}
    </div>

    <div class="card-body" style="max-height: 450px; overflow-y: auto;">
      {% for msg in messages_list %}
        <div class="mb-3 {% if msg.sender == request.user %}text-end{% endif %}">
          <div class="{% if msg.sender == request.user %}bg-primary text-white{% else %}bg-light{% endif %} p-2 rounded d-inline-block">
            <strong>{{ msg.sender.username }}</strong><br>
            {{ msg.content }}
          </div><br>
          <small class="text-muted">{{ msg.timestamp|date:"d M Y, h:i A" }}</small>
        </div>
      {% empty %}
        <p class="text-muted text-center">No messages yet. Start the conversation!</p>
      {% endfor %}
    </div>

    <div class="card-footer">
      <form method="post">
        {% csrf_token %}
        {{ form.content }}
        <button type="submit" class="btn btn-primary mt-2 w-100">ðŸ“¨ Send Message</button>
      </form>
    </div>
  </div>
</div>

<style>
  .card {
    border-radius: 12px;
  }
  .card-body {
    background-color: #f9fafb;
  }
  .card-body::-webkit-scrollbar {
    width: 6px;
  }
  .card-body::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 10px;
  }
</style>

{% endblock %}
